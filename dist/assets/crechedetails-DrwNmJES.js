import{h as M,a as i,j as e,L as q}from"./react-BA1Wa0um.js";import{u as J,c as m}from"./index-rhoGazYf.js";import"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const H=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],Y=({message:o,type:x,onClose:r})=>(i.useEffect(()=>{const n=setTimeout(()=>{r()},5e3);return()=>clearTimeout(n)},[r]),e.jsx("div",{className:`toast ${x}`,children:e.jsxs("div",{className:"toast-content",children:[e.jsx("span",{className:"toast-message",children:o}),e.jsx("button",{className:"toast-close",onClick:r,children:"×"})]})})),X=()=>{const{id:o}=M(),{getToken:x}=J(),r=x(),[n,D]=i.useState(null),[b,L]=i.useState([]),[p,j]=i.useState(!0),[P,v]=i.useState([]),[T,N]=i.useState(!1),[f,S]=i.useState(null),[y,B]=i.useState([]),[h,w]=i.useState([]),[_,C]=i.useState(new Date().toISOString().split("T")[0]),[u,g]=i.useState(!0),[F,A]=i.useState(!1),d=(s,a="error")=>{const t=Date.now();v(c=>[...c,{id:t,message:s,type:a}])},I=s=>{v(a=>a.filter(t=>t.id!==s))},$=()=>{S(null),w([]),C(new Date().toISOString().split("T")[0]),g(!0)};i.useEffect(()=>{async function s(){try{const[a,t]=await Promise.all([fetch(`${m.API_BASE_URL}mynursery/${o}/`,{headers:{Authorization:`Bearer ${r}`}}),fetch(`${m.API_BASE_URL}nursery/${o}/plans/`,{headers:{Authorization:`Bearer ${r}`}})]);if(!a.ok)throw new Error("Erreur lors du chargement de la crèche");if(!t.ok)throw new Error("Erreur lors du chargement des plans");const c=await a.json(),l=await t.json();D(c),L(l.results||[])}catch(a){d(a.message||"Une erreur est survenue")}finally{j(!1)}}s()},[o,r]);const R=async s=>{S(s),A(!0);try{const a=await fetch(`${m.API_BASE_URL}child/`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Erreur lors du chargement des enfants");const t=await a.json();B(t.results||[]),N(!0)}catch(a){d(a.message)}finally{A(!1)}},U=s=>{w(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},z=async s=>{if(s.preventDefault(),h.length===0){d("Veuillez sélectionner au moins un enfant","warning");return}try{j(!0);const t={start_date:u?new Date().toISOString().split("T")[0]:_,details:h.map(l=>({child:l}))},c=await fetch(`${m.API_BASE_URL}nursery/${o}/plans/${f.id}/subscriptions/`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)});if(!c.ok){const l=await c.json();throw new Error((l==null?void 0:l.message)||"Erreur lors de la souscription")}d("Souscription réussie !","success"),N(!1),$()}catch(a){d(a.message||"Une erreur est survenue lors de la souscription")}finally{j(!1)}},E=()=>{N(!1),$()};if(p)return e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des informations..."})]});if(!n)return null;const k=m.MEDIA_BASE_URL,V=n.photo_exterior?`${k}${n.photo_exterior}`:"/blanc.jpg",O=n.photo_interior?`${k}${n.photo_interior}`:"/blanc.jpg";return e.jsxs("div",{className:"creche-details-container",children:[e.jsx("div",{className:"toast-container",children:P.map(s=>e.jsx(Y,{message:s.message,type:s.type,onClose:()=>I(s.id)},s.id))}),e.jsxs("div",{className:"creche-header",children:[e.jsx("h1",{className:"creche-title",children:n.name}),e.jsxs("div",{className:"creche-meta",children:[e.jsxs("span",{className:"meta-item",children:[e.jsx("i",{className:"icon location-icon"}),n.address]}),e.jsxs("span",{className:"meta-item",children:[e.jsx("i",{className:"icon phone-icon"}),n.contact_number]})]})]}),e.jsxs("section",{className:"photo-gallery",children:[e.jsxs("div",{className:"gallery-item",children:[e.jsx("div",{className:"gallery-label",children:"Vue extérieure"}),e.jsx("img",{src:V,alt:"Extérieur de la crèche",className:"gallery-image"})]}),e.jsxs("div",{className:"gallery-item",children:[e.jsx("div",{className:"gallery-label",children:"Vue intérieure"}),e.jsx("img",{src:O,alt:"Intérieur de la crèche",className:"gallery-image"})]})]}),e.jsxs("section",{className:"info-section",children:[e.jsx("h2",{className:"section-title",children:"Présentation"}),e.jsxs("div",{className:"info-card",children:[e.jsx("p",{className:"description-text",children:n.information||"Cette crèche ne dispose pas encore de description."}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Statut juridique"}),e.jsx("span",{className:"info-value",children:n.legal_status})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Âge maximum"}),e.jsxs("span",{className:"info-value",children:[n.max_age," mois"]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Capacité"}),e.jsxs("span",{className:"info-value",children:[n.max_children_per_class," enfants/classe"]})]})]})]})]}),e.jsxs("section",{className:"schedule-section",children:[e.jsx("h2",{className:"section-title",children:"Horaires d'ouverture"}),e.jsx("div",{className:"schedule-grid",children:n.opening_hours.map((s,a)=>{var t,c;return e.jsxs("div",{className:"schedule-item",children:[e.jsx("span",{className:"day",children:H[s.day]}),e.jsx("span",{className:"hours",children:s.is_closed?"Fermé":`${(t=s.open_time)==null?void 0:t.slice(0,5)} - ${(c=s.close_time)==null?void 0:c.slice(0,5)}`})]},a)})})]}),e.jsxs("section",{className:"plans-section",children:[e.jsx("h2",{className:"section-title",children:"Nos formules d'abonnement"}),b.length===0?e.jsx("div",{className:"no-plans",children:e.jsx("p",{children:"Aucune formule disponible actuellement."})}):e.jsx("div",{className:"plans-grid",children:b.map(s=>e.jsxs("div",{className:"plan-card",children:[e.jsxs("div",{className:"plan-header",children:[e.jsx("h3",{className:"plan-name",children:s.name}),e.jsxs("div",{className:"plan-price",children:[parseFloat(s.price).toLocaleString()," FCFA"]})]}),e.jsx("div",{className:"plan-duration",children:s.duration}),e.jsx("p",{className:"plan-description",children:s.description}),e.jsxs("button",{onClick:()=>R(s),className:"subscribe-button",children:["Souscrire",e.jsx("i",{className:"arrow-icon"})]})]},s.id))})]}),T&&e.jsx("div",{className:"subscription-overlay",children:e.jsxs("div",{className:"subscription-form-container",children:[e.jsx("button",{className:"close-button",onClick:E,children:"×"}),e.jsxs("h2",{children:["Souscription à la formule ",f.name]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Période de validité:"}),e.jsx("div",{children:f.duration})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Début de l'abonnement:"}),e.jsxs("div",{className:"radios",children:[e.jsxs("div",{className:"radio",children:[e.jsx("input",{type:"radio",id:"startNow",checked:u,onChange:()=>g(!0)}),e.jsx("label",{htmlFor:"startNow",children:"Immédiatement"})]}),e.jsxs("div",{className:"radio",children:[e.jsx("input",{type:"radio",id:"startLater",checked:!u,onChange:()=>g(!1)}),e.jsx("label",{htmlFor:"startLater",children:"À une date ultérieure"})]})]}),!u&&e.jsx("input",{type:"date",value:_,onChange:s=>C(s.target.value),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Sélectionnez les enfants:"}),F?e.jsx("p",{children:"Chargement des enfants..."}):y.length>0?e.jsx("div",{className:"children-checkboxes",children:y.map(s=>e.jsxs("div",{className:"child-checkbox",children:[e.jsx("input",{type:"checkbox",id:`child-${s.id}`,checked:h.includes(s.id),onChange:()=>U(s.id)}),e.jsxs("label",{htmlFor:`child-${s.id}`,children:[s.first_name," ",s.last_name," (",s.age," mois)"]})]},s.id))}):e.jsxs("p",{className:"no-children-message",children:["Aucun enfant enregistré. ",e.jsx("br",{}),"Veuillez ",e.jsx(q,{to:"/inscrireenfant/0",children:"ajouter un enfant"})," avant de souscrire."]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:E,children:"Annuler"}),e.jsx("button",{type:"submit",className:"confirm-button",disabled:h.length===0||p,children:p?"Traitement...":"Confirmer la souscription"})]})]})]})})]})};export{X as default};
