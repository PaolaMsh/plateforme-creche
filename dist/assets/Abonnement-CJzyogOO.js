import{a,j as e,L as N}from"./react-BA1Wa0um.js";import{u as g,c as m}from"./index-rhoGazYf.js";import"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const _=()=>{const{getToken:x}=g(),i=x(),[c,o]=a.useState([]),[j,l]=a.useState(!0),[d,h]=a.useState(null),[p,t]=a.useState(!1),[r,f]=a.useState(null);a.useEffect(()=>{(async()=>{try{const n=await fetch(`${m.API_BASE_URL}mysubscriptions/`,{headers:{Authorization:`Bearer ${i}`}});if(!n.ok)throw new Error("Erreur lors de la récupération des abonnements");const v=await n.json();o(v.results),l(!1)}catch(n){h(n.message),l(!1)}})()},[i]);const b=async()=>{try{if(!(await fetch(`${m.API_BASE_URL}nursery/${r.plan.nursery.id}/plans/${r.plan.id}/subscriptions/${r.id}/`,{method:"PATCH",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({is_active:!1})})).ok)throw new Error("Erreur lors de l'annulation de l'abonnement");o(c.map(n=>n.id===r.id?{...n,is_active:!1}:n)),t(!1)}catch(s){h(s.message)}},u=s=>s?new Date(s).toLocaleDateString("fr-FR"):"Non spécifié";return j?e.jsx("div",{className:"subscription-container",children:"Chargement en cours..."}):d?e.jsxs("div",{className:"subscription-container",children:["Erreur: ",d]}):e.jsxs("div",{className:"subscription-container",children:[e.jsx("header",{className:"subscription-header",children:e.jsx("h1",{children:"Mes abonnements"})}),e.jsx("div",{className:"subscription-grid",children:c.map(s=>e.jsxs("div",{className:`subscription-card ${s.is_active?"active":"expired"}`,children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("h3",{children:[s.plan.name," - ",s.plan.nursery.name]}),e.jsx("span",{className:`badge ${s.is_active?"active":"expired"}`,children:s.is_active?"Actif":"Expiré"})]}),e.jsxs("div",{className:"card-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",s.plan.duration==="month"?"Mensuel":"Hebdomadaire"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Prix:"})," ",s.price," FCFA"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date début:"})," ",u(s.start_date)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date fin:"})," ",u(s.end_date)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Enfants:"})," ",s.detail_objects.length]})]}),e.jsxs("div",{className:"card-actions",children:[e.jsx(N,{to:`/suivredetails/${s.id}`,className:"action-link",children:e.jsx("button",{className:"btn btn-primary",children:"Détails"})}),s.is_active?e.jsx("button",{className:"btn btn-secondary",onClick:()=>{f(s),t(!0)},children:"Annuler"}):e.jsx(e.Fragment,{})]})]},s.id))}),p&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-button",onClick:()=>t(!1),children:"×"}),e.jsx("p",{children:"Êtes-vous sûr de vouloir annuler cet abonnement ?"}),e.jsxs("div",{className:"menu-buttons",children:[e.jsx("button",{onClick:b,className:"menu-button confirm",children:"Oui"}),e.jsx("button",{onClick:()=>t(!1),className:"menu-button cancel",children:"Non"})]})]})})]})};export{_ as default};
