import{u as T,h as w,a as c,j as e}from"./react-BA1Wa0um.js";import{u as C,c as d}from"./index-rhoGazYf.js";import"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const U=()=>{const{getToken:j}=C(),p=j(),h=T(),{id:N}=w(),n=parseInt(N||"0",10),[t,g]=c.useState({nom:"",prenom:"",age:"",particularite:""}),[x,r]=c.useState(""),[v,i]=c.useState(""),l=a=>{g({...t,[a.target.name]:a.target.value})},b=a=>{const s=new Date;return s.setMonth(s.getMonth()-parseInt(a)),s.toISOString().split("T")[0]},y=a=>{const s=new Date(a),o=new Date;return((o.getFullYear()-s.getFullYear())*12+(o.getMonth()-s.getMonth())).toString()},A=async()=>{try{const a=await fetch(`${d.API_BASE_URL}child/${n}/`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}});if(a.ok){const s=await a.json();g({nom:s.last_name||"",prenom:s.first_name||"",age:y(s.birthday),particularite:s.detail||""})}else r("Impossible de charger les données de l'enfant."),i("error")}catch(a){console.error(a),r("Erreur réseau."),i("error")}};c.useEffect(()=>{n!==0&&A()},[n]);const I=async a=>{a.preventDefault();const{nom:s,prenom:o,age:m,particularite:S}=t;if(s&&o&&m){const _=b(m),D={parent_id:4,last_name:s,first_name:o,birthday:_,detail:S};try{const u=n===0?`${d.API_BASE_URL}child/`:`${d.API_BASE_URL}child/${n}/`,f=await fetch(u,{method:n===0?"POST":"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(D)});if(f.ok)r(n===0?"Inscription réussie !":"Modifications enregistrées !"),i("success"),setTimeout(()=>h("/Accueil"),1500);else{const M=await f.json();r("Une erreur est survenue. "+(M.detail||"")),i("error")}}catch(u){r("Erreur réseau ou serveur."),i("error"),console.error("Erreur API:",u)}}else r("⚠️ Veuillez remplir tous les champs obligatoires."),i("error")},E=()=>{h("/Accueil")};return e.jsxs("div",{className:"inscription-container",children:[e.jsx("div",{className:"header-decoration"}),e.jsxs("div",{className:"content-wrapper",children:[e.jsx("h1",{children:n===0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"icon"})," Inscrire mon enfant"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"icon"})," Modifier les informations de ",t.prenom||"l'enfant"]})}),e.jsxs("div",{className:"card-container",children:[e.jsxs("div",{className:"illustration-side",children:[e.jsx("div",{className:"illustration-frame",children:e.jsx("img",{src:"/incrirenfant.jpg",alt:"Inscription enfant",className:"child-illustration"})}),e.jsx("div",{className:"decoration-element"})]}),e.jsx("div",{className:"form-side",children:e.jsxs("form",{onSubmit:I,className:"enfant-form",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"floating-label",children:"Nom"}),e.jsx("input",{type:"text",name:"nom",value:t.nom,onChange:l,className:"floating-input",required:!0}),e.jsx("div",{className:"input-underline"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"floating-label",children:"Prénom(s)"}),e.jsx("input",{type:"text",name:"prenom",value:t.prenom,onChange:l,className:"floating-input",required:!0}),e.jsx("div",{className:"input-underline"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"floating-label",children:"Âge (en mois)"}),e.jsx("input",{type:"number",name:"age",value:t.age,onChange:l,className:"floating-input",min:"0",max:"120",required:!0}),e.jsx("div",{className:"input-underline"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"floating-label",children:"Particularités"}),e.jsx("textarea",{name:"particularite",rows:"4",value:t.particularite,onChange:l,className:"floating-textarea"}),e.jsx("div",{className:"input-underline"})]}),x&&e.jsx("div",{className:`notification ${v}`,children:x}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:E,className:"cancel-button",children:"Annuler"}),e.jsx("button",{type:"submit",className:"submit-button",children:n===0?e.jsx(e.Fragment,{children:"Inscrire"}):e.jsx(e.Fragment,{children:"Enregistrer"})})]})]})})]})]})]})};export{U as default};
