import{e as F,u as L,a,j as e,L as E}from"./react-BA1Wa0um.js";import{c as w}from"./index-rhoGazYf.js";import{a as v,F as m,p as M,h as q,q as I,s as _}from"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const D=()=>{const[i,p]=F();L();const[l,f]=a.useState(i.get("name")||""),[r,N]=a.useState(parseInt(i.get("page")||"1")),[x,b]=a.useState([]),[C,S]=a.useState(!1),[j,k]=a.useState(null),[R,o]=a.useState([]),[h,y]=a.useState(""),[t,P]=a.useState(0),[d]=a.useState(10),u=a.useRef();a.useEffect(()=>{g(l,r)},[i]),a.useEffect(()=>{if(h){const s=x.filter(c=>c.address&&c.address.toLowerCase().includes(h.toLowerCase()));o(s)}else o(x)},[x,h]);const g=async(s="",c=1)=>{u.current&&u.current.cancel("Requête annulée pour nouvelle recherche"),u.current=v.CancelToken.source(),S(!0),k(null);try{const n=await v.get(`${w.API_BASE_URL}mynursery/`,{params:{name:s,page:c,page_size:d},cancelToken:u.current.token});b(n.data.results),o(n.data.results),P(n.data.count||0)}catch(n){v.isCancel(n)||(k(n.message),b([]),o([]),P(0))}finally{S(!1)}},A=s=>{s.preventDefault(),N(1),p({name:l,page:"1"})},T=s=>{N(s),p({name:l,page:s.toString()}),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs("div",{className:"creche-garderie-container",children:[e.jsxs("div",{className:"search-container",children:[e.jsx("h1",{children:"Trouver une crèche"}),e.jsx("p",{className:"subtitle",children:"Recherchez la crèche qui correspond à vos besoins"}),e.jsx("form",{className:"search-form",onSubmit:A,children:e.jsxs("div",{className:"search-input-group",children:[e.jsx(m,{icon:M,className:"search-icon"}),e.jsx("input",{type:"search",name:"name",placeholder:"Rechercher par nom...",value:l,onChange:s=>f(s.target.value),"aria-label":"Rechercher une crèche"}),e.jsx("button",{type:"submit",className:"search-button",children:"Rechercher"})]})})]}),e.jsxs("div",{className:"filters-container",children:[e.jsx("div",{className:"results-count",children:t>0?e.jsxs("span",{children:[t," ",t===1?"résultat":"résultats"," trouvés"]}):e.jsx("span",{children:"Aucun résultat"})}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"location-filter",className:"filter-label",children:"Filtrer par ville :"}),e.jsxs("select",{id:"location-filter",name:"location-filter",value:h,onChange:s=>y(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"Toutes les villes"}),e.jsx("option",{value:"cotonou",children:"Cotonou"}),e.jsx("option",{value:"parakou",children:"Parakou"}),e.jsx("option",{value:"porto-novo",children:"Porto-Novo"}),e.jsx("option",{value:"abomey",children:"Abomey"})]})]})]}),C&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Chargement en cours..."})]}),j&&e.jsxs("div",{className:"error-message",children:[e.jsxs("p",{children:["Une erreur est survenue : ",j]}),e.jsx("button",{onClick:()=>g(l,r),className:"retry-button",children:"Réessayer"})]}),!C&&!j&&e.jsx(e.Fragment,{children:R.length>0?e.jsx("div",{className:"creches-grid",children:R.map(s=>e.jsx("div",{className:"creche-card",children:e.jsxs(E,{to:`/crechedetails/${s.id}`,className:"creche-link",children:[e.jsxs("div",{className:"creche-image-container",children:[e.jsx("img",{src:s.image||"/blanc.jpg",alt:s.name,className:"creche-image",onError:c=>{c.target.onerror=null,c.target.src="/blanc.jpg"}}),e.jsx("div",{className:"creche-overlay"})]}),e.jsxs("div",{className:"creche-info",children:[e.jsx("h3",{className:"creche-name",children:s.name}),e.jsxs("div",{className:"creche-location",children:[e.jsx(m,{icon:q,className:"location-icon"}),e.jsx("span",{children:s.address||"Adresse non disponible"})]}),e.jsx("div",{className:"creche-cta",children:"Voir les détails"})]})]})},s.id))}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucune crèche ne correspond à votre recherche "',i.get("name"),'"']}),e.jsx("button",{onClick:()=>{f(""),y(""),p({}),g()},className:"reset-filters-button",children:"Réinitialiser les filtres"})]})}),t>d&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("button",{onClick:()=>T(r-1),disabled:r===1,className:"pagination-button",children:[e.jsx(m,{icon:I}),"Précédent"]}),e.jsxs("div",{className:"page-indicator",children:["Page ",r," sur ",Math.ceil(t/d)]}),e.jsxs("button",{onClick:()=>T(r+1),disabled:r>=Math.ceil(t/d),className:"pagination-button",children:["Suivant",e.jsx(m,{icon:_})]})]})]})};export{D as default};
