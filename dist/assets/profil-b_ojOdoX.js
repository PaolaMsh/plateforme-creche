import{u as z,a as u,j as e,L as I}from"./react-BA1Wa0um.js";import{u as q,c as N}from"./index-rhoGazYf.js";import{F as l,f as V,t as H,u as J,v as O,j as Y,n as G,w as K,x as P,y as F}from"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const se=()=>{const{getToken:B}=q(),p=B(),E=z(),[r,_]=u.useState({nom:"",prenom:"",dateNaissance:"",email:"",telephone:""}),[Q,L]=u.useState(null),[j,y]=u.useState("informations"),[T,g]=u.useState(!1),[o,R]=u.useState(null),[A,w]=u.useState([]),[C,$]=u.useState([]),[i,f]=u.useState({profil:"",enfants:"",abonnements:""});u.useEffect(()=>{const s=async()=>{var a,h,x,c;if(p)try{const t=await fetch(`${N.API_BASE_URL}profil/`,{headers:{Authorization:`Bearer ${p}`}});if(!t.ok)throw new Error("Erreur lors du chargement du profil");const m=await t.json();if(((a=m.results)==null?void 0:a.length)>0){const b=m.results[0];L(b.id),_({nom:((h=b.user)==null?void 0:h.last_name)||"",prenom:((x=b.user)==null?void 0:x.first_name)||"",email:((c=b.user)==null?void 0:c.email)||"",telephone:b.contact||"",dateNaissance:b.birthday||""})}}catch(t){console.error(t),f(m=>({...m,profil:"Erreur lors du chargement du profil"}))}},n=async()=>{var a;try{const h=await fetch(`${N.API_BASE_URL}child/`,{headers:{Authorization:`Bearer ${p}`}});if(!h.ok)throw new Error("Erreur lors de la récupération des enfants");const x=await h.json();w(((a=x.results)==null?void 0:a.map(c=>({id:c.id,nomComplet:`${c.last_name} ${c.first_name}`,age:S(c.birthday)+" mois",dateInscription:new Date(c.joined_date||c.created_at).toLocaleDateString("fr-FR")})))||[])}catch(h){console.error(h),f(x=>({...x,enfants:"Erreur lors du chargement des enfants"}))}},d=async()=>{try{const a=await fetch(`${N.API_BASE_URL}mysubscriptions/`,{headers:{Authorization:`Bearer ${p}`}});if(!a.ok)throw new Error("Erreur lors de la récupération des abonnements");const c=(await a.json()).results.filter(t=>t.is_active).map(t=>({id:t.id,creche:t.plan.nursery.name,type:t.plan.name,statut:"Actif",dateDebut:new Date(t.start_date).toLocaleDateString("fr-FR"),dateFin:t.end_date?new Date(t.end_date).toLocaleDateString("fr-FR"):"En cours",prix:t.price,nursery_id:t.plan.nursery.id,plan_id:t.plan.id,enfants:t.detail_objects.map(m=>({id:m.child.id,nomComplet:`${m.child.last_name} ${m.child.first_name}`,age:S(m.child.birthday)+" mois"}))}));$(c)}catch(a){console.error(a),f(h=>({...h,abonnements:"Erreur lors du chargement des abonnements"}))}};s(),n(),d()},[p]);const S=s=>{if(!s)return 0;const n=new Date(s),d=new Date;return(d.getFullYear()-n.getFullYear())*12+d.getMonth()-n.getMonth()},v=s=>{const{name:n,value:d}=s.target;_(a=>({...a,[n]:d}))},M=async s=>{s.preventDefault();try{const n={user:{first_name:r.prenom,last_name:r.nom,email:r.email},contact:r.telephone,birthday:r.dateNaissance};f({...i,profil:"Profil mis à jour avec succès"})}catch(n){console.error(n),f({...i,profil:"Erreur lors de la mise à jour"})}},D=(s,n)=>{R({item:s,type:n}),g(!0)},U=async()=>{try{if(o.type==="enfant"){const s={existe:0};if((await fetch(`${N.API_BASE_URL}child/${o.item.id}/`,{method:"PATCH",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)w(d=>d.filter(a=>a.id!==o.item.id)),f({...i,enfants:"Enfant supprimé avec succès"});else throw new Error("Échec de la suppression")}else{const s={is_active:!1};if((await fetch(`${N.API_BASE_URL}nursery/${o.item.nursery_id}/plans/${o.item.plan_id}/subscriptions/${o.item.id}/`,{method:"PATCH",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)$(d=>d.filter(a=>a.id!==o.item.id)),f({...i,abonnements:"Abonnement annulé avec succès"});else throw new Error("Échec de l'annulation")}}catch(s){console.error(s),f(n=>({...n,[o.type==="enfant"?"enfants":"abonnements"]:"Erreur lors de la suppression"}))}finally{g(!1)}},k=(s,n)=>{n==="enfant"?E(`/inscrireenfant/${s.id}`):E(`/suivredetails/${s.id}`,{state:{abonnement:s,enfants:s.enfants}})};return e.jsxs("div",{className:"profile-container",children:[T&&e.jsx("div",{className:"confirmation-modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Confirmer la suppression"}),e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer ",(o==null?void 0:o.type)==="enfant"?`l'enfant ${o.item.nomComplet}`:"cet abonnement"," ?"]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:()=>g(!1),className:"btn-cancel",children:"Annuler"}),e.jsx("button",{onClick:U,className:"btn-confirm",children:"Confirmer"})]})]})}),e.jsxs("div",{className:"profile-header",children:[e.jsxs("div",{className:"avatar-section",children:[e.jsx("div",{className:"avatar",children:e.jsx(l,{icon:V})}),e.jsxs("div",{className:"user-info",children:[e.jsxs("h2",{children:[r.prenom," ",r.nom]}),e.jsx("p",{children:r.email})]})]}),e.jsx("div",{className:"profile-actions",children:j==="informations"?e.jsxs("button",{type:"submit",form:"profile-form",className:"btn-primary",children:[e.jsx(l,{icon:H})," Enregistrer"]}):e.jsxs("button",{onClick:()=>y("informations"),className:"btn-secondary",children:[e.jsx(l,{icon:J})," Modifier profil"]})})]}),e.jsxs("div",{className:"profile-tabs",children:[e.jsxs("button",{className:`tab ${j==="informations"?"active":""}`,onClick:()=>y("informations"),children:[e.jsx(l,{icon:O})," Informations"]}),e.jsxs("button",{className:`tab ${j==="enfants"?"active":""}`,onClick:()=>y("enfants"),children:[e.jsx(l,{icon:Y})," Enfants (",A.length,")"]}),e.jsxs("button",{className:`tab ${j==="abonnements"?"active":""}`,onClick:()=>y("abonnements"),children:[e.jsx(l,{icon:G})," Abonnements (",C.length,")"]})]}),e.jsxs("div",{className:"profile-content",children:[j==="informations"&&e.jsxs("form",{id:"profile-form",onSubmit:M,className:"info-section",children:[e.jsx("h3",{children:"Informations personnelles"}),i.profil&&e.jsx("div",{className:`alert ${i.profil.includes("succès")?"success":"error"}`,children:i.profil}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nom"}),e.jsx("input",{type:"text",name:"nom",value:r.nom,onChange:v,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Prénom"}),e.jsx("input",{type:"text",name:"prenom",value:r.prenom,onChange:v,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date de naissance"}),e.jsx("input",{type:"date",name:"dateNaissance",value:r.dateNaissance,onChange:v})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:v,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Téléphone"}),e.jsx("input",{type:"tel",name:"telephone",value:r.telephone,onChange:v})]})]})]}),j==="enfants"&&e.jsxs("div",{className:"enfants-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Mes enfants"}),e.jsxs(I,{to:"/inscrireenfant/0",className:"btn-primary",children:[e.jsx(l,{icon:K})," Ajouter un enfant"]})]}),i.enfants&&e.jsx("div",{className:`alert ${i.enfants.includes("succès")?"success":"error"}`,children:i.enfants}),A.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nom complet"}),e.jsx("th",{children:"Âge"}),e.jsx("th",{children:"Inscrit le"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:A.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nomComplet}),e.jsx("td",{children:s.age}),e.jsx("td",{children:s.dateInscription}),e.jsxs("td",{className:"actions",children:[e.jsx("button",{onClick:()=>k(s,"enfant"),className:"btn-icon",title:"Voir détails",children:e.jsx(l,{icon:P})}),e.jsx("button",{onClick:()=>D(s,"enfant"),className:"btn-icon danger",title:"Supprimer",children:e.jsx(l,{icon:F})})]})]},s.id))})]})}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Aucun enfant inscrit pour le moment"})})]}),j==="abonnements"&&e.jsxs("div",{className:"abonnements-section",children:[e.jsx("h3",{children:"Mes abonnements"}),i.abonnements&&e.jsx("div",{className:`alert ${i.abonnements.includes("succès")?"success":"error"}`,children:i.abonnements}),C.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Crèche"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Statut"}),e.jsx("th",{children:"Début"}),e.jsx("th",{children:"Fin"}),e.jsx("th",{children:"Prix"}),e.jsx("th",{children:"Enfants"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.creche}),e.jsx("td",{children:s.type}),e.jsx("td",{children:e.jsx("span",{className:"status-badge actif",children:s.statut})}),e.jsx("td",{children:s.dateDebut}),e.jsx("td",{children:s.dateFin}),e.jsxs("td",{children:[s.prix," FCFA"]}),e.jsx("td",{children:s.enfants.map(n=>e.jsxs("div",{children:[n.nomComplet," (",n.age,")"]},n.id))}),e.jsxs("td",{className:"actions",children:[e.jsx("button",{onClick:()=>k(s,"abonnement"),className:"btn-icon",title:"Voir détails",children:e.jsx(l,{icon:P})}),e.jsx("button",{onClick:()=>D(s,"abonnement"),className:"btn-icon danger",title:"Annuler",children:e.jsx(l,{icon:F})})]})]},s.id))})]})}):e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"Aucun abonnement actif pour le moment"}),e.jsx(I,{to:"/creches",className:"btn-primary",children:"Voir les crèches disponibles"})]})]})]})]})};export{se as default};
