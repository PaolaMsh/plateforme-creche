import{h as X,d as K,u as Q,a as l,j as e,i as W,k as Z,l as b,m as $,n as T,o as ee}from"./react-BA1Wa0um.js";import{u as se,c as j}from"./index-rhoGazYf.js";import"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const ie=()=>{const{id:N}=X(),{getToken:P}=se(),d=P(),g=K();Q();const[t,p]=l.useState(null),[R,y]=l.useState(!0),[A,I]=l.useState(null),[L,m]=l.useState(!1),[J,h]=l.useState(!1),[M,i]=l.useState(!1),[B,o]=l.useState(""),[w,c]=l.useState(""),[u,C]=l.useState(""),[S,F]=l.useState("jours"),[f,D]=l.useState(""),[E,H]=l.useState([]);l.useEffect(()=>{var n;const s=async()=>{try{const r=await fetch(`${j.API_BASE_URL}mysubscriptions/${N}/`,{headers:{Authorization:`Bearer ${d}`}});if(!r.ok)throw new Error("Erreur lors du chargement de l'abonnement");const a=await r.json();p(a),await z(a.plan.nursery.id),y(!1)}catch(r){I(r.message),y(!1)}};(n=g.state)!=null&&n.abonnement,s()},[N,d,g.state]);const z=async s=>{try{const n=await fetch(`${j.API_BASE_URL}nursery/${s}/plans/`,{headers:{Authorization:`Bearer ${d}`}});if(!n.ok)throw new Error("Erreur lors du chargement des formules");const r=await n.json();H(r.results)}catch(n){console.error(n),c("error"),o("Erreur lors du chargement des formules disponibles"),i(!0),setTimeout(()=>i(!1),5e3)}},_=(s,n,r)=>{const a=new Date(s);switch(r){case"heures":a.setHours(a.getHours()+parseInt(n));break;case"jours":a.setDate(a.getDate()+parseInt(n));break;case"semaines":a.setDate(a.getDate()+parseInt(n)*7);break;case"mois":a.setMonth(a.getMonth()+parseInt(n));break}return a.toISOString().split("T")[0]},q=async s=>{if(s.preventDefault(),!u||isNaN(u)||parseInt(u)<=0){c("error"),o("Veuillez entrer une durée valide"),i(!0),setTimeout(()=>i(!1),5e3);return}try{const n=t.end_date||t.start_date,r=_(n,u,S);if(!(await fetch(`${j.API_BASE_URL}nursery/${t.plan.nursery.id}/plans/${t.plan.id}/subscriptions/${t.id}/`,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({end_date:r})})).ok)throw new Error("Échec de la prolongation");const k={...t,end_date:r};p(k),c("success"),o(`Abonnement prolongé jusqu'au ${new Date(r).toLocaleDateString("fr-FR")}`),i(!0),C(""),F("jours"),m(!1),setTimeout(()=>i(!1),6e3)}catch(n){console.error(n),c("error"),o("Erreur lors de la prolongation de l'abonnement"),i(!0),setTimeout(()=>i(!1),5e3)}},O=async s=>{if(s.preventDefault(),!f){c("error"),o("Veuillez sélectionner une nouvelle formule"),i(!0),setTimeout(()=>i(!1),5e3);return}try{const n=E.find(G=>G.id.toString()===f);if(!n)throw new Error("Formule non trouvée");let r;switch(n.duration){case"day":r=1;break;case"week":r=7;break;case"month":r=30;break;default:r=1}const a=_(t.start_date,r,"jours");if(!(await fetch(`${j.API_BASE_URL}nursery/${t.plan.nursery.id}/plans/${t.plan.id}/subscriptions/${t.id}/`,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({plan:n.id,end_date:a})})).ok)throw new Error("Échec du changement de formule");const Y={...t,plan:n,end_date:a};p(Y),c("success"),o(`Formule changée à ${n.name}`),i(!0),D(""),h(!1),setTimeout(()=>i(!1),6e3)}catch(n){console.error(n),c("error"),o("Erreur lors du changement de formule"),i(!0),setTimeout(()=>i(!1),5e3)}},v=s=>s?new Date(s).toLocaleDateString("fr-FR"):"Non spécifié",U=[{time:"7h30-9h00",title:"Accueil & Jeux libres",items:["Jeux symboliques","Jeux de construction","Lecture autonome"]},{time:"9h-9h30",title:"Rituel du matin",items:["Comptines","Histoires","Présence et météo"]},{time:"9h30-11h00",title:"Ateliers éducatifs",items:["Motricité fine (pâte à modeler)","Créatif (peinture, collage)","Sensoriel (jeux d'eau, sable)","Langagier (marionnettes)"]},{time:"11h00-12h00",title:"Repas",items:["Installation","Repas encadré","Hygiène post-repas"]},{time:"12h00-15h00",title:"Sieste/Temps calme",items:["Coucher personnalisé","Lecture douce","Jeux calmes pour les non-dormeurs"]},{time:"15h00-15h30",title:"Réveil & Goûter",items:["Réveil échelonné","Collation","Hygiène"]},{time:"15h30-16h30",title:"Activités de l'après-midi",items:["Jeux extérieurs","Activité artistique (dessin)","Jeux symboliques (marchande)"]},{time:"16h30-18h30",title:"Jeux libres & Départs",items:["Jeux de société","Lecture","Déguisements","Transmissions aux parents"]}];if(R)return e.jsx("div",{className:"subscription-container main",children:"Chargement en cours..."});if(A)return e.jsxs("div",{className:"subscription-container main",children:["Erreur: ",A]});if(!t)return e.jsx("div",{className:"subscription-container main",children:"Aucun abonnement trouvé"});const x=t.is_active;return e.jsxs("div",{className:"subscription-container main",children:[e.jsxs("header",{className:"subscription-header",children:[e.jsx("h1",{children:"Détails de l'abonnement"}),!x&&e.jsx("p",{className:"inactive-notice",style:{color:"red"},children:"Cet abonnement n'est plus actif"}),e.jsxs("p",{className:"subtitle",children:["Suivi complet de votre abonnement ",x?"et des activités":""]})]}),e.jsx("section",{className:"subscription-info",children:e.jsxs("div",{className:"info-card",children:[e.jsxs("h2",{children:["Abonnement #",t.id]}),e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx(W,{className:"info-icon"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Crèche"}),e.jsx("p",{children:t.plan.nursery.name})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(Z,{className:"info-icon"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Période"}),e.jsxs("p",{children:["Du ",v(t.start_date),e.jsx("br",{}),"Au ",v(t.end_date)||"Non spécifié"]})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(b,{className:"info-icon"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Formule actuelle"}),e.jsx("p",{children:t.plan.name})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(b,{className:"info-icon"}),e.jsxs("div",{children:[e.jsx("h4",{children:"Prix"}),e.jsxs("p",{children:[t.price," FCFA"]})]})]})]})]})}),e.jsxs("section",{className:"children-section",children:[e.jsx("h3",{children:"Enfants inscrits"}),e.jsx("div",{className:"children-list",children:t.detail_objects.map((s,n)=>e.jsxs("div",{className:"child-card",children:[e.jsxs("div",{className:"child-avatar",children:[s.child.first_name[0],s.child.last_name[0]]}),e.jsxs("div",{className:"child-info",children:[e.jsxs("h4",{children:[s.child.first_name," ",s.child.last_name]}),e.jsxs("p",{children:[V(s.child.birthday)," mois"]})]})]},n))})]}),x&&e.jsxs("section",{className:"activities-section",children:[e.jsx("h2",{children:"Programme de la journée"}),e.jsx("div",{className:"timeline",children:U.map((s,n)=>e.jsxs("div",{className:"timeline-item",children:[e.jsx("div",{className:"timeline-time",children:s.time}),e.jsxs("div",{className:"timeline-content",children:[e.jsx("h3",{children:s.title}),e.jsx("ul",{children:s.items.map((r,a)=>e.jsx("li",{children:r},a))})]})]},n))})]}),x&&e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{className:"btn-primary",onClick:()=>m(!0),children:[e.jsx($,{})," Prolonger l'abonnement"]}),e.jsxs("button",{className:"btn-secondary",onClick:()=>h(!0),children:[e.jsx($,{})," Changer de formule"]})]}),L&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Prolonger l'abonnement"}),e.jsx("button",{className:"close-btn",onClick:()=>m(!1),children:e.jsx(T,{})})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Formule actuelle"}),e.jsx("input",{type:"text",value:t.plan.name,readOnly:!0}),e.jsx("label",{children:"Date de fin actuelle"}),e.jsx("input",{type:"text",value:v(t.end_date)||"Non spécifié",readOnly:!0}),e.jsx("label",{children:"Durée de prolongation"}),e.jsxs("div",{className:"duration-input",children:[e.jsx("input",{type:"number",min:"1",placeholder:"Durée",value:u,onChange:s=>C(s.target.value),required:!0}),e.jsxs("select",{value:S,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"heures",children:"Heures"}),e.jsx("option",{value:"jours",children:"Jours"}),e.jsx("option",{value:"semaines",children:"Semaines"}),e.jsx("option",{value:"mois",children:"Mois"})]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>m(!1),children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn-confirm",children:"Confirmer"})]})]})})]})}),J&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Changer de formule"}),e.jsx("button",{className:"close-btn",onClick:()=>h(!1),children:e.jsx(T,{})})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Formule actuelle"}),e.jsx("input",{type:"text",value:t.plan.name,readOnly:!0,className:"readonly-input"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nouvelle formule"}),e.jsxs("select",{value:f,onChange:s=>D(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionnez une formule"}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.price," FCFA)"]},s.id))]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>h(!1),children:"Annuler"}),e.jsx("button",{type:"submit",className:"btn-confirm",children:"Confirmer"})]})]})})]})}),M&&e.jsx("div",{className:`alert-notification ${w}`,children:e.jsxs("div",{className:"alert-content",children:[w==="success"?e.jsx(ee,{}):e.jsx(b,{}),e.jsx("span",{children:B})]})})]});function V(s){if(!s)return 0;const n=new Date(s),r=new Date;return(r.getFullYear()-n.getFullYear())*12+r.getMonth()-n.getMonth()}};export{ie as default};
