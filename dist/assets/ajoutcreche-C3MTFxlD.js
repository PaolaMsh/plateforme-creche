import{a as d,j as e,p as D,q as x,s as I,t as p,v as P,w as q,x as R,y as T}from"./react-BA1Wa0um.js";import{u as B,c as y}from"./index-rhoGazYf.js";import"./vendor-CSi4VfSZ.js";import"./react-dom-C64KspPm.js";const J=()=>{const{getToken:C}=B(),j=C(),[o,F]=d.useState(1),[r,N]=d.useState({name:"Crèche ABC",address:"123 Rue Exemple",contact_number:"0123456789",information:"Informations diverses",max_age:36,max_children_per_class:12,legal_status:"agrée",agreement_document:null,id_card_document:null,photo_exterior:null,photo_interior:null}),[m,b]=d.useState([{day:0,name:"Lundi",open:"08:00",close:"18:00",closed:!1},{day:1,name:"Mardi",open:"08:00",close:"18:00",closed:!1},{day:2,name:"Mercredi",open:"08:00",close:"18:00",closed:!1},{day:3,name:"Jeudi",open:"08:00",close:"18:00",closed:!1},{day:4,name:"Vendredi",open:"08:00",close:"18:00",closed:!1},{day:5,name:"Samedi",open:"",close:"",closed:!0},{day:6,name:"Dimanche",open:"",close:"",closed:!0}]),[S,A]=d.useState({agreement_document:"Aucun fichier sélectionné",id_card_document:"Aucun fichier sélectionné",photo_exterior:"Aucun fichier sélectionné",photo_interior:"Aucun fichier sélectionné"}),t=s=>{const{id:a,value:n}=s.target;N(c=>({...c,[a]:a==="max_age"||a==="max_children_per_class"?parseInt(n,10):n}))},k=(s,a)=>{const n=a.target.files[0];n&&(N(c=>({...c,[s]:n})),A(c=>({...c,[s]:n.name})))},f=(s,a,n)=>{const c=[...m];c[s]={...c[s],[a]:n},b(c)},w=(s,a)=>{const n=[...m];n[s]={...n[s],closed:a,open:a?"":"08:00",close:a?"":"18:00"},b(n)},i=s=>F(s),$=async s=>{s.preventDefault();const a=new FormData;a.append("name",r.name),a.append("address",r.address),a.append("contact_number",r.contact_number),a.append("information",r.information||""),a.append("max_age",String(r.max_age)),a.append("max_children_per_class",String(r.max_children_per_class)),a.append("legal_status",r.legal_status),["agreement_document","id_card_document","photo_exterior","photo_interior"].forEach(l=>{r[l]&&a.append(l,r[l])});let n;try{n=await fetch(`${y.API_BASE_URL}nursery/`,{method:"POST",headers:{Authorization:`Bearer ${j}`},body:a})}catch(l){return console.error("Erreur réseau création crèche :",l),alert("Erreur réseau lors de la création de la crèche.")}if(!n.ok){const l=await n.json();return console.error("Erreur API création crèche :",l),alert(`Échec création crèche :
`+JSON.stringify(l,null,2))}const{id:c}=await n.json(),E=m.map(l=>{const g=parseInt(l.day,10),v=(l.open||"").trim(),_=(l.close||"").trim(),u=l.closed||!v||!_;return{day:isNaN(g)?null:g,open_time:u?null:`${v}:00`,close_time:u?null:`${_}:00`,is_closed:u}});let h;try{h=await fetch(`${y.API_BASE_URL}nursery/${c}/opening-hours/`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify(E)})}catch(l){return console.error("Erreur réseau envoi horaires :",l),alert("Erreur réseau lors de l’envoi des horaires.")}if(!h.ok){const l=await h.json();return console.error("Erreur API envoi horaires :",l),alert(`Échec envoi horaires :
`+JSON.stringify(l,null,2))}alert("Crèche et horaires enregistrés avec succès !")};return e.jsxs(e.Fragment,{children:[e.jsx("link",{href:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css",rel:"stylesheet"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"form-container",children:[e.jsx("div",{className:"form-header",children:e.jsxs("h2",{children:[e.jsx(D,{className:"me-2"})," Inscrire ma crèche"]})}),e.jsx("div",{className:"form-steps",children:[1,2,3,4].map(s=>e.jsxs("div",{className:`step ${o===s?"active":o>s?"completed":""}`,"data-step":s,children:[e.jsx("div",{className:"step-number",children:s}),e.jsxs("div",{className:"step-title",children:[s===1&&"Informations de la crèche",s===2&&"Horaires d'ouverture",s===3&&"Documents",s===4&&"Validation"]})]},s))}),e.jsxs("form",{onSubmit:$,id:"nurseryForm",className:"form-body",children:[e.jsxs("div",{className:`form-step ${o===1?"active":""}`,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Nom de la crèche"}),e.jsx("input",{type:"text",id:"name",className:"form-control",value:r.name,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Adresse"}),e.jsx("input",{type:"text",id:"address",className:"form-control",value:r.address,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"contact_number",className:"form-label",children:"Téléphone"}),e.jsx("input",{type:"tel",id:"contact_number",className:"form-control",value:r.contact_number,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"max_age",className:"form-label",children:"Âge max (mois)"}),e.jsx("input",{type:"number",id:"max_age",className:"form-control",value:r.max_age,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"max_children_per_class",className:"form-label",children:"Enfants max/classe"}),e.jsx("input",{type:"number",id:"max_children_per_class",className:"form-control",value:r.max_children_per_class,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{htmlFor:"legal_status",className:"form-label",children:"Statut légal"}),e.jsxs("select",{id:"legal_status",className:"form-select",value:r.legal_status,onChange:t,required:!0,children:[e.jsx("option",{value:"agrée",children:"Agréée"}),e.jsx("option",{value:"declared",children:"Déclarée"}),e.jsx("option",{value:"municipal",children:"Municipale"}),e.jsx("option",{value:"other",children:"Autre"})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"information",className:"form-label",children:"Informations complémentaires"}),e.jsx("textarea",{id:"information",className:"form-control",rows:"4",value:r.information,onChange:t})]}),e.jsx("div",{className:"form-actions text-end",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>i(2),children:["Suivant ",e.jsx(x,{className:"ms-1"})]})})]}),e.jsxs("div",{className:`form-step ${o===2?"active":""}`,children:[e.jsxs("h4",{className:"mb-4",children:[e.jsx(I,{className:"me-2"}),"Horaires d'ouverture"]}),m.map((s,a)=>e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("span",{className:"me-3",style:{width:"80px"},children:s.name}),e.jsx("input",{type:"time",className:"form-control me-2",value:s.open,onChange:n=>f(a,"open",n.target.value),disabled:s.closed}),e.jsx("input",{type:"time",className:"form-control me-2",value:s.close,onChange:n=>f(a,"close",n.target.value),disabled:s.closed}),e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`closed-${s.day}`,checked:s.closed,onChange:n=>w(a,n.target.checked)}),e.jsx("label",{className:"form-check-label",htmlFor:`closed-${s.day}`,children:"Fermé"})]})]},s.day)),e.jsxs("div",{className:"form-actions d-flex justify-content-between",children:[e.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>i(1),children:[e.jsx(p,{className:"me-1"})," Précédent"]}),e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>i(3),children:["Suivant ",e.jsx(x,{className:"ms-1"})]})]})]}),e.jsxs("div",{className:`form-step ${o===3?"active":""}`,children:[e.jsxs("h4",{className:"mb-4",children:[e.jsx(P,{className:"me-2"}),"Documents requis"]}),e.jsx("div",{className:"row g-3",children:[{id:"agreement_document",label:"Document d'agrément"},{id:"id_card_document",label:"Carte d'identité"},{id:"photo_exterior",label:"Photo extérieure"},{id:"photo_interior",label:"Photo intérieure"}].map(s=>e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:s.label}),e.jsxs("div",{className:"file-upload",children:[e.jsx("input",{type:"file",id:s.id,accept:".pdf,.jpg,.jpeg,.png",className:"file-upload-input",onChange:a=>k(s.id,a)}),e.jsxs("label",{htmlFor:s.id,className:"file-upload-label",children:[e.jsx(q,{}),e.jsx("span",{className:"ms-2",children:"Cliquez pour téléverser"}),e.jsx("div",{className:"file-name",children:S[s.id]})]})]})]},s.id))}),e.jsxs("div",{className:"form-actions d-flex justify-content-between mt-4",children:[e.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>i(2),children:[e.jsx(p,{className:"me-1"})," Précédent"]}),e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>i(4),children:["Suivant ",e.jsx(x,{className:"ms-1"})]})]})]}),e.jsxs("div",{className:`form-step ${o===4?"active":""}`,children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(R,{className:"text-success",style:{fontSize:"4rem"}}),e.jsx("h3",{className:"mt-3",children:"Vérification des informations"}),e.jsx("p",{className:"text-muted",children:"Veuillez vérifier que toutes les informations sont correctes avant de soumettre."})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"mb-0",children:"Récapitulatif"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nom :"})," ",r.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Adresse :"})," ",r.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Téléphone :"})," ",r.contact_number]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Âge max :"})," ",r.max_age," mois"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Enfants/classe :"})," ",r.max_children_per_class]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Statut légal :"})," ",r.legal_status==="agrée"?"Agréée":r.legal_status==="declared"?"Déclarée":r.legal_status==="municipal"?"Municipale":"Autre"]})]})]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsx("h5",{className:"mb-0",children:"Horaires d'ouverture"})}),e.jsx("div",{className:"card-body",children:m.map(s=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[s.name," :"]})," ",s.closed?"Fermé":`${s.open} - ${s.close}`]},s.day))})]}),e.jsxs("div",{className:"form-actions d-flex justify-content-between",children:[e.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>i(3),children:[e.jsx(p,{className:"me-1"})," Précédent"]}),e.jsxs("button",{type:"submit",className:"btn btn-success",children:[e.jsx(T,{className:"me-1"})," Soumettre"]})]})]})]})]})})]})};export{J as default};
